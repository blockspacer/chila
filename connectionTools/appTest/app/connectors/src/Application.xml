<?xml version="1.0" encoding="UTF-8"?>

<!--
    Copyright 2011 Roberto Daniel Gimenez Gamarra
    (C.I.: 1.439.390 - Paraguay)

     This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<application name="chila.connectionTools.appTest.app.connectors.gen.Application">

    <!-- Aliases -->
    <argumentAliases>
        <alias name="clientId"          description=""/>
        <alias name="recvBuffer"        description=""/>
        <alias name="sndBuffer"         description=""/>
        <alias name="errorMsg"          description=""/>
        <alias name="moduleName"        description=""/>
        <alias name="procMessage"       description=""/>
    </argumentAliases>

    <connectorAliases>
        <alias name="Network" connectorPath="chila.connectionTools.appTest.app.connectors.gen.Network">
            <argument name="clientId"       argumentAlias="clientId"        />
            <argument name="recvBuffer"     argumentAlias="recvBuffer"      />
            <argument name="sndBuffer"      argumentAlias="sndBuffer"       />
            <argument name="errorMsg"       argumentAlias="errorMsg"        />
            <argument name="moduleName"     argumentAlias="moduleName"      />
        </alias>

        <alias name="Logger" connectorPath="chila.connectionTools.appTest.app.connectors.gen.Logger">
            <argument name="clientId"       argumentAlias="clientId"        />
            <argument name="recvBuffer"     argumentAlias="recvBuffer"      />
            <argument name="sndBuffer"      argumentAlias="sndBuffer"       />
            <argument name="errorMsg"       argumentAlias="errorMsg"        />
            <argument name="moduleName"     argumentAlias="moduleName"      />
        </alias>

        <alias name="MessageProcessor" connectorPath="chila.connectionTools.appTest.app.connectors.gen.MessageProcessor">
            <argument name="procMessage"    argumentAlias="procMessage"     />
            <argument name="result"         argumentAlias="sndBuffer"       />
            <argument name="moduleName"     argumentAlias="moduleName"      />
        </alias>
    </connectorAliases>

    <!-- Argument generators -->
    <argumentProviderCreators>

        <creator name="networkNameProv"
                 requires=""
                 provides="moduleName"              />

        <creator name="processingNameProv"
                 requires=""
                 provides="moduleName"              />

        <creator name="procMessageCreator"
                 requires="clientId, recvBuffer"
                 provides="procMessage"             />

        <creator name="procMessageReaderPC"
                 requires="procMessage"
                 provides="clientId"                />

    </argumentProviderCreators>

    <!-- Connections -->
    <connectors>

        <!-- Network -->
        <instance name="network" connectorAlias="Network">

            <event name="started"                aProviderCreators="networkNameProv"
                                                 actions="logger.moduleStarted,
                                                          messageProcessor.start"                 />

            <event name="clientConnected"        actions="logger.clientConnected"          />

            <event name="clientDisconnected"     actions="logger.clientDisconnected"       />

            <event name="msgReceived"            aProviderCreators="procMessageCreator"
                                                 actions="logger.msgReceived,
                                                          messageProcessor.processMessage"        />

        </instance>

        <!-- MessageProcessor -->
        <instance name="messageProcessor" connectorAlias="MessageProcessor">
            <event name="started"                aProviderCreators="processingNameProv"
                                                 actions="logger.moduleStarted"            />

            <event name="messageProcessed"       aProviderCreators="procMessageReaderPC"
                                                 actions="logger.msgProcessed,
                                                          network.sendMessage"              />
        </instance>

        <!-- Logger -->
        <instance name="logger" connectorAlias="Logger"/>

    </connectors>

</application>
